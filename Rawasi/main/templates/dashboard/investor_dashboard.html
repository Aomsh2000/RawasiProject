{% extends 'main/base.html'%}
{%load static%}

{%block title%}<title>لوحة التحكم - المستثمر</title>{%endblock%}
{%block head%}
<style>
body {
  background-image: url("/static/images/Background.png");
  background-size: cover;
}
</style>
{%endblock%}
{%block content%}
    
<section class="container rounded-3 dashboard shadow">
  {% if messages %}
  {% for message in messages %}
  {% if not request.session.show_message or message.tags != request.session.show_message %}
      <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-success{% endif %}" role="alert">
          {{ message }}
      </div>
      {% endif %}
  {% endfor %}
{% endif %}
  <div class="row dashboard-row">
      <!-- Sidebar -->
      <div class="col-md-3 p-3 d-flex flex-column justify-content-between dashboard-side">
        <div>
          <h4 class=" mb-4 text-center ">مرحبا <span>{{investor.user.full_name}}</span></h4>
          <ul class="nav flex-column dashboard-links">
              <li class="nav-item">
               
                
                <a class="nav-link-dashboard active" href="#" data-content="section1">
                  <i class="fa-solid fa-boxes-stacked"></i>
                  <span class="px-2">الصناديق</span> 
                </a>

              </li>
              <li class="nav-item">
                  <a class="nav-link-dashboard" href="#" data-content="section2">
                    <i class="fa-solid fa-bullhorn"></i>
                    <span class="px-2">التصويت</span> 
                  </a>
              </li>
              <li class="nav-item">
                  <a class="nav-link-dashboard" href="#" data-content="section3">
                    <i class="fa-solid fa-coins"></i>
                    <span class="px-2">الأرباح</span> 
                  </a>
              </li>
              <li class="nav-item">
                  <a class="nav-link-dashboard" href="#" data-content="section4">
                    <i class="fa-solid fa-wallet"></i>
                    <span class="px-2">المحفظة</span> 
                  </a>
              </li>
              <li class="nav-item">
                  <a class="nav-link-dashboard" href="#" data-content="section5">
                    <i class="fa-regular fa-address-card"></i>
                    <span class="px-2">حسابي</span> 
                  </a>
              </li>
          </ul>
        </div>
        <div class="d-flex justify-content-center">
      <button class="btn btn-darkgreen" data-bs-toggle="modal" data-bs-target="#codeModal">
        انضمام   </button>
          <!-- Modal Structure -->
          <div class="modal fade" id="codeModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              
              <div class="modal-content">
                <div class="modal-header border-white d-flex justify-content-between">
                    <h5 class="modal-title" id="exampleModalLabel">الرمز</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="POST">
                        {% csrf_token %}
                        <input type="text" name="join_code" maxlength="10" class="form-control" placeholder="أدخل رمز الانضمام" required/>
                        <div class="modal-footer border-white">
                            <button type="submit" name="submit_code" class="btn btn-darkgreen">ارسال</button>
                        </div>
                    </form>
                </div>
              </div>

            </div>
        </div>
        

        </div>
      </div>

      <!-- Content Area -->
      <div class="col-md-9 p-3">
        <div id="section1" class="dashboard-section">
            <div class="container fund-container">
                <div class="row">
                    <!-- Half Table -->
                    <div class="col-md-6">
                        <h3>الصناديق الاستثمارية</h3>
                        <table class="table table-striped fund-table">
                            <thead>
                                <tr>
                                    <th>اسم الصندوق</th>
                                    <th>المبلغ المستثمر</th>
                                    <th>الحالة</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if joined_funds %}
                                    {% for investor_fund in joined_funds %}
                                        <tr class="fund-row" data-fund-id="{{ investor_fund.fund.id }}">
                                            <td>{{ investor_fund.fund.name }}</td>
                                            <td>{{ investor_fund.amount_invested }} ر.س</td>
                                            <td>
                                                {% if investor_fund.fund.is_active == 'Active' %}
                                                    <span class="text-success">نشط</span>
                                                {% else %}
                                                    <span class="text-danger">غير نشط</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="3" class="text-center">لم تنضم إلى أي صندوق بعد.</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
      
          <div id="section2" class="dashboard-section" style="display: none;">
            <div class="row">
                <div  class="col-md-3 investment-card border p-0 rounded-3" >
                  <img src="{%static 'images/building-66375_1280.jpg'%}" class="w-100"/>
                  <div class="p-2">
                    <h5>اسم الاستثمار</h5>
                    <small>وصف الاستثمار</small>
                    <div class="d-flex justify-content-between">
                      <div class="d-flex gap-1">
                        <a href="" class="  p-0 text-success fs-5"> <i class="fa-solid fa-square-check"></i></a>
                        <a href="" class=" text-danger p-0 fs-5 "> <i class="fa-solid fa-square-xmark"></i></a>
                      </div>  
                      <a class="btn btn-darkgreen p-0 px-1 mx-1"><small> تفاصيل</small></a>
                    </div>
                    </div>
                </div>
              </div>
          </div>
          <div id="section3" class="dashboard-section" style="display: none;">
            <div class="container p-0">
                <!-- Section 3 Header -->
                <div class="text-center mb-4">
                    <h2 style="color: #761305;">تفاصيل الأرباح</h2>
                    <p>سحب الأرباح المحققة من استثماراتك</p>
                </div>
        
                <!-- Profit Table -->
                <div class="profit-container p-4 bg-white shadow-sm rounded">
                    <table class="table table-striped text-center">
                        <thead>
                            <tr>
                                <th>اسم الصندوق</th>
                                <th>المبلغ المستثمر</th>
                                <th>الأرباح المحققة</th>
                                <th>الحالة</th>
                                <th>إجراء</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if profit_data %}
                                {% for data in profit_data %}
                                <tr>
                                    <td>{{ data.fund_name }}</td>
                                    <td>{{ data.amount_invested }} ر.س</td>
                                    <td>{{ data.profit }} ر.س</td>
                                    <td>{{ data.status }}</td>
                                    <td>
                                        <form method="POST" action="{% url 'investment_fund:withdraw_profit' %}">
                                            {% csrf_token %}
                                            <input type="hidden" name="fund_name" value="{{ data.fund_name }}">
                                            <input type="hidden" name="profit" value="{{ data.profit }}">
                                            <button type="submit" class="btn btn-darkgreen">سحب الأرباح</button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center">لا توجد بيانات أرباح حاليا.</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
          <div id="section4" class="dashboard-section" style="display: none;">
            
            <div class="container p-0">
                <!-- Section 4 Header -->
                <h3 class="text-center mb-4" style="color: #761305;">محفظتك</h3>
                <h1></h1>
                <!-- Wallet Container -->
                <div class="wallet-container mt-4 p-3 bg-white shadow-sm rounded">
                    <h4 class="text-center" style="color: #761305;">محفظتك</h4>
                    {% if wallet %}
                  
                    <div class="text-center mt-3">
            
              <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header d-flex justify-content-between">
                        <h5 class="modal-title" id="depositModalLabel">إضافة أموال إلى المحفظة</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                    <form method="POST" action="{% url 'investment_fund:deposit_to_wallet' %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="amount" class="form-label">المبلغ</label>
                            <input type="number" name="amount" id="amount" class="form-control" placeholder="أدخل المبلغ" required>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">الوصف</label>
                            <input type="text" name="description" id="description" class="form-control" placeholder="اختياري">
                        </div>
                        <button type="submit" class="btn btn-darkgreen w-100 mt-3">إتمام الإيداع</button>
                    </form>
                                    
                    </div>
                </div>
            </div>
        </div>
        

        <div class="modal fade" id="transferModal" tabindex="-1" aria-labelledby="transferModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header d-flex justify-content-between">
                        <h5 class="modal-title" id="withdrawModalLabel">تحويل أموال إلى الصندوق</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    {% if fund %}
    <form method="POST" action="{% url 'investment_fund:transfer_to_fund' pk=fund.id %}">
        {% csrf_token %}
        <div class="mb-3">
            <label for="withdraw-amount" class="form-label">المبلغ</label>
            <input type="number" name="amount" class="form-control" id="withdraw-amount" placeholder="أدخل المبلغ" required>
        </div>
        <button type="submit" class="btn btn-darkred w-100">إتمام التحويل</button>
    </form>
{% else %}
    <p class="text-center">لم يتم العثور على صندوق الاستثمار الخاص بك.</p>
{% endif %}
                </div>
            </div>
        </div>
                </div>
              </div>
              <!-- Withdraw Profit Modal -->
<div class="modal fade" id="withdrawModal" tabindex="-1" aria-labelledby="withdrawModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="withdrawModalLabel">سحب الأرباح</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
                <form method="POST" action="{% url 'investment_fund:withdraw_profit' %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="amount" class="form-label">المبلغ المراد سحبه</label>
                        <input type="number" name="amount" id="amount" class="form-control" placeholder="أدخل المبلغ" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">الوصف (اختياري)</label>
                        <input type="text" name="description" id="description" class="form-control" placeholder="أدخل وصف السحب">
                    </div>
                    <button type="submit" class="btn btn-darkgreen w-100">تأكيد السحب</button>
                </form>
            </div>
            
          </div>   
        </div>        
          <div id="section5" class="dashboard-section" style="display: none;">
            <h3>Content for Section 5</h3>
            <p>This is where the content for Section 5 will be displayed.</p>
        </div>
        </div>        
          
       
      </div>
  
</section>
  {%endblock%}
  {%block script%}
  <script>
    // Handle the section content change
    const navLinks = document.querySelectorAll('.nav-link-dashboard');
    const sections = document.querySelectorAll('.dashboard-section');

    // Set the default visible section
    const defaultSection = 'section1'; // This can be any section you want to show by default
    document.getElementById(defaultSection).style.display = 'block';
    document.querySelector(`.nav-link-dashboard[data-content="${defaultSection}"]`).classList.add('active');
    
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();

            // Remove the 'active' class from all nav links
            navLinks.forEach(link => link.classList.remove('active'));
            // Add 'active' class to the clicked link
            link.classList.add('active');

            // Hide all sections
            sections.forEach(section => {
                section.style.display = 'none';
            });

            // Show the content corresponding to the clicked section
            const sectionId = link.getAttribute('data-content');
            const activeSection = document.getElementById(sectionId);
            activeSection.style.display = 'block';
        });
    });
</script>

{%endblock%}